---
interface Props {
  title?: string;
  content: any;
  image?: string;
  imageOnRight?: boolean;
}

const { title, content, image, imageOnRight = false } = Astro.props;

// Helper to render TinaMarkdown content to HTML
function renderRichText(node: any): string {
  if (!node) return '';

  if (typeof node === 'string') return node;

  if (node.type === 'root') {
    return node.children?.map(renderRichText).join('') || '';
  }

  if (node.type === 'text') {
    let text = node.text || '';
    if (node.bold) text = `<strong>${text}</strong>`;
    if (node.italic) text = `<em>${text}</em>`;
    return text;
  }

  if (node.type === 'p') {
    const content = node.children?.map(renderRichText).join('') || '';
    return `<p>${content}</p>`;
  }

  if (node.type === 'h2') {
    const content = node.children?.map(renderRichText).join('') || '';
    return `<h2>${content}</h2>`;
  }

  if (node.type === 'h3') {
    const content = node.children?.map(renderRichText).join('') || '';
    return `<h3>${content}</h3>`;
  }

  if (node.type === 'ul') {
    const content = node.children?.map(renderRichText).join('') || '';
    return `<ul>${content}</ul>`;
  }

  if (node.type === 'li') {
    const content = node.children?.map(renderRichText).join('') || '';
    return `<li>${content}</li>`;
  }

  if (node.type === 'lic') {
    return node.children?.map(renderRichText).join('') || '';
  }

  return '';
}
---

<section class="section bg-gray-50">
  <div class="container-custom">
    <div class={`grid grid-cols-1 lg:grid-cols-2 gap-12 items-center ${imageOnRight ? '' : 'lg:flex-row-reverse'}`}>
      <!-- Text Content -->
      <div class={imageOnRight ? 'order-1' : 'order-1 lg:order-2'}>
        {title && (
          <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-6">
            {title}
          </h2>
        )}
        {content && (
          <div class="prose-custom text-gray-600" set:html={renderRichText(content)} />
        )}
      </div>

      <!-- Image -->
      <div class={imageOnRight ? 'order-2' : 'order-2 lg:order-1'}>
        {image ? (
          <img
            src={image}
            alt={title || ''}
            class="rounded-xl shadow-lg w-full"
          />
        ) : (
          <div class="bg-gray-200 rounded-xl aspect-video flex items-center justify-center">
            <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
          </div>
        )}
      </div>
    </div>
  </div>
</section>
